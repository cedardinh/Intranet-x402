<svg xmlns="http://www.w3.org/2000/svg" width="2400" height="1350" viewBox="0 0 2400 1350">
  <defs>
    <style>
      .title { font: 700 56px 'Segoe UI', Arial, sans-serif; fill: #0f172a; }
      .subtitle { font: 400 28px 'Segoe UI', Arial, sans-serif; fill: #334155; }
      .stepTitle { font: 700 28px 'Segoe UI', Arial, sans-serif; fill: #0b3b8f; }
      .stepText { font: 500 24px 'Segoe UI', Arial, sans-serif; fill: #0f172a; }
      .num { font: 700 26px 'Segoe UI', Arial, sans-serif; fill: #ffffff; }
      .foot { font: 500 24px 'Segoe UI', Arial, sans-serif; fill: #334155; }
    </style>
    <marker id="arrow" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="10" markerHeight="10" orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#2563eb"/>
    </marker>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="0" dy="6" stdDeviation="8" flood-color="#0f172a" flood-opacity="0.12"/>
    </filter>
  </defs>

  <rect width="2400" height="1350" fill="#f8fafc"/>

  <text x="120" y="120" class="title">x402 Demo Flow (Real Code Path)</text>
  <text x="120" y="170" class="subtitle">From MCP invocation to paid resource delivery</text>

  <!-- Row 1 -->
  <g filter="url(#shadow)">
    <rect x="120" y="240" rx="20" ry="20" width="480" height="170" fill="#ffffff" stroke="#cbd5e1" stroke-width="2"/>
    <circle cx="170" cy="295" r="28" fill="#2563eb"/>
    <text x="161" y="304" class="num">1</text>
    <text x="220" y="300" class="stepText">MCP tool call starts</text>

    <rect x="700" y="240" rx="20" ry="20" width="480" height="170" fill="#ffffff" stroke="#cbd5e1" stroke-width="2"/>
    <circle cx="750" cy="295" r="28" fill="#2563eb"/>
    <text x="741" y="304" class="num">2</text>
    <text x="800" y="290" class="stepText">Initial request to</text>
    <text x="800" y="325" class="stepText">/weather endpoint</text>

    <rect x="1280" y="240" rx="20" ry="20" width="480" height="170" fill="#ffffff" stroke="#cbd5e1" stroke-width="2"/>
    <circle cx="1330" cy="295" r="28" fill="#2563eb"/>
    <text x="1321" y="304" class="num">3</text>
    <text x="1380" y="300" class="stepText">402 Payment Required</text>

    <rect x="1860" y="240" rx="20" ry="20" width="420" height="170" fill="#ffffff" stroke="#cbd5e1" stroke-width="2"/>
    <circle cx="1910" cy="295" r="28" fill="#2563eb"/>
    <text x="1901" y="304" class="num">4</text>
    <text x="1960" y="290" class="stepText">Decode requirements</text>
    <text x="1960" y="325" class="stepText">+ sign payload</text>
  </g>

  <!-- Row 1 arrows -->
  <line x1="600" y1="325" x2="680" y2="325" stroke="#2563eb" stroke-width="6" marker-end="url(#arrow)"/>
  <line x1="1180" y1="325" x2="1260" y2="325" stroke="#2563eb" stroke-width="6" marker-end="url(#arrow)"/>
  <line x1="1760" y1="325" x2="1840" y2="325" stroke="#2563eb" stroke-width="6" marker-end="url(#arrow)"/>

  <!-- Row 2 -->
  <g filter="url(#shadow)">
    <rect x="120" y="560" rx="20" ry="20" width="560" height="170" fill="#ffffff" stroke="#cbd5e1" stroke-width="2"/>
    <circle cx="170" cy="615" r="28" fill="#2563eb"/>
    <text x="161" y="624" class="num">5</text>
    <text x="220" y="605" class="stepText">Retry with</text>
    <text x="220" y="640" class="stepText">PAYMENT-SIGNATURE</text>

    <rect x="790" y="560" rx="20" ry="20" width="420" height="170" fill="#ffffff" stroke="#cbd5e1" stroke-width="2"/>
    <circle cx="840" cy="615" r="28" fill="#2563eb"/>
    <text x="831" y="624" class="num">6</text>
    <text x="890" y="622" class="stepText">Facilitator /verify</text>

    <rect x="1320" y="560" rx="20" ry="20" width="560" height="170" fill="#ffffff" stroke="#cbd5e1" stroke-width="2"/>
    <circle cx="1370" cy="615" r="28" fill="#2563eb"/>
    <text x="1361" y="624" class="num">7</text>
    <text x="1420" y="605" class="stepText">Server prepares the</text>
    <text x="1420" y="640" class="stepText">paid weather report</text>

    <rect x="1990" y="560" rx="20" ry="20" width="290" height="170" fill="#ffffff" stroke="#cbd5e1" stroke-width="2"/>
    <circle cx="2040" cy="615" r="28" fill="#2563eb"/>
    <text x="2031" y="624" class="num">8</text>
    <text x="2090" y="622" class="stepText">Facilitator /settle</text>
  </g>

  <!-- Row 2 arrows -->
  <line x1="680" y1="645" x2="770" y2="645" stroke="#2563eb" stroke-width="6" marker-end="url(#arrow)"/>
  <line x1="1210" y1="645" x2="1300" y2="645" stroke="#2563eb" stroke-width="6" marker-end="url(#arrow)"/>
  <line x1="1880" y1="645" x2="1970" y2="645" stroke="#2563eb" stroke-width="6" marker-end="url(#arrow)"/>

  <!-- Connector between rows -->
  <path d="M 2230 410 L 2280 410 L 2280 645 L 2280 645" stroke="#2563eb" stroke-width="6" fill="none" marker-end="url(#arrow)"/>

  <!-- Final -->
  <g filter="url(#shadow)">
    <rect x="520" y="900" rx="24" ry="24" width="1360" height="220" fill="#dbeafe" stroke="#2563eb" stroke-width="3"/>
    <circle cx="600" cy="980" r="36" fill="#2563eb"/>
    <text x="588" y="992" class="num">9</text>
    <text x="680" y="965" class="stepTitle">Final Response</text>
    <text x="680" y="1015" class="stepText">Server returns 200 OK with the paid resource</text>
  </g>

  <line x1="2135" y1="730" x2="1550" y2="890" stroke="#2563eb" stroke-width="6" marker-end="url(#arrow)"/>

  <text x="120" y="1260" class="foot">Flow aligned with current implementation: MCP Bridge + Express Resource Server + Facilitator + Monitor.</text>
</svg>
